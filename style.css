/* Only differences from prior version: z-index layering, right-stack pointer-events, flash button, commands panel emphasis. */

:root {
  --bg:#08101c;
  --txt:#f0f6ff;
  --muted:#9fb0c6;
  --cyan:#00f2ea;
  --pink:#ff1180;
  --gold:#f7d25c;
  --bronze:#c97a32;
  --silver:#c9d2df;
  --danger:#ff5d5d;
  --good:#5df28f;
  --panel-bg:rgba(14,22,34,0.78);
  --panel-border:rgba(255,255,255,0.18);
  --shadow-strong:0 0 30px rgba(0,242,234,0.45),0 0 60px rgba(255,0,128,0.32);
  --transition:0.25s cubic-bezier(.4,.14,.3,1);
  --scale-handle-size:14px;
  --drag-bar-height:34px;
}

*{box-sizing:border-box;}
html,body,#app,#game-container{
  margin:0;padding:0;width:100%;height:100%;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,Arial,'Noto Sans',sans-serif;
  color:var(--txt);overflow:hidden;background:#08101c;
  background-image:
    radial-gradient(1200px 800px at 15% 20%,rgba(0,242,234,0.20),transparent 70%),
    radial-gradient(1000px 750px at 85% 80%,rgba(255,0,128,0.16),transparent 72%),
    linear-gradient(140deg,#08101c,#0d1e2f 55%,#112235);
  background-blend-mode:screen,screen,normal;
  animation:bgPulse 18s linear infinite;
}
@keyframes bgPulse{0%,100%{filter:brightness(1);}50%{filter:brightness(1.13);}}

/* Layering */
#fx-canvas{position:absolute;inset:0;z-index:10;}
#board-frame,#board-divider,#slot-tray,#board-title,#tray-dividers{position:absolute;inset:0;z-index:15;}
#overlay{position:absolute;inset:0;z-index:90;}
#commands-panel{z-index:150;}
#settings-panel{z-index:140;}
#redeem-layer{z-index:160;}
#perf-panel{z-index:170;}
#dev-panel{z-index:130;}

#board-frame{
  border-radius:24px;
  border:2px solid rgba(0,242,234,0.55);
  box-shadow:0 0 20px rgba(0,242,234,0.5),0 0 50px rgba(255,0,128,0.25),inset 0 0 120px rgba(0,0,0,0.55);
  background:radial-gradient(circle at 50% 18%,rgba(0,242,234,0.10),transparent 65%),linear-gradient(180deg,rgba(15,25,40,0.55),rgba(10,18,30,0.9));
}

#overlay{
  display:grid;
  grid-template-columns:340px 1fr 300px;
  grid-template-rows:auto 1fr;
  gap:14px;padding:14px;
  pointer-events:none;
}

.branding,#controls-panel,.panel,#commands-panel,#reward-teasers,#leaderboard,#dev-panel,#settings-panel{
  pointer-events:auto;
}

#controls-panel{display:flex;align-items:center;gap:8px;}
#btn-gear,#btn-show-commands,#btn-flash-commands{
  background:#132536;
  color:var(--txt);
  border:1px solid #264063;
  border-radius:12px;
  padding:8px 12px;
  font-size:14px;
  cursor:pointer;
  font-weight:600;
  box-shadow:0 0 10px rgba(0,242,234,0.35);
  transition:var(--transition);
}
#btn-gear:hover,#btn-show-commands:hover,#btn-flash-commands:hover{filter:brightness(1.2);transform:translateY(-2px);}

#right-stack{grid-row:2;grid-column:3;display:flex;flex-direction:column;gap:18px;pointer-events:auto;}

#commands-panel{
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:28px;
  padding:16px 18px 26px;
  backdrop-filter:blur(18px) saturate(170%);
  box-shadow:0 0 34px rgba(0,242,234,0.38),0 0 70px rgba(255,0,128,0.28);
  width:340px;
  position:relative;
  transition:var(--transition);
}
#commands-panel.fixed-mode{
  position:fixed !important;
  top:110px !important;
  right:24px !important;
  left:auto !important;
  bottom:auto !important;
  transform:none !important;
}
#commands-panel.hidden-soft{opacity:0;pointer-events:none;}
.cmd-title{
  font-weight:900;font-size:24px;letter-spacing:2px;
  background:linear-gradient(90deg,#fff,#00f2ea 45%,#ff5aa0 80%);
  -webkit-background-clip:text;color:transparent;
  text-shadow:0 0 14px rgba(0,242,234,0.5),0 0 28px rgba(255,0,128,0.4);
  margin:0 0 14px;
  display:flex;align-items:center;justify-content:center;gap:10px;
  cursor:grab;
}
.mini-close{
  position:absolute;
  right:6px;top:6px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.25);
  color:var(--txt);
  font-size:11px;
  padding:4px 6px;
  border-radius:8px;
  cursor:pointer;
  transition:var(--transition);
}
.mini-close:hover{filter:brightness(1.25);}

.panel-recover{
  animation:flashRecover 1.6s ease-in-out;
}
@keyframes flashRecover{
  0%{box-shadow:0 0 0 0 rgba(255,255,255,0),0 0 0 0 rgba(0,242,234,0);}
  25%{box-shadow:0 0 0 3px rgba(255,255,255,0.45),0 0 40px 10px rgba(0,242,234,0.55);}
  60%{box-shadow:0 0 0 2px rgba(255,255,255,0.25),0 0 25px 6px rgba(0,242,234,0.4);}
  100%{box-shadow:0 0 34px rgba(0,242,234,0.38),0 0 70px rgba(255,0,128,0.28);}
}

/* Keep redemption focus from hiding commands */
body.redeem-focus #commands-panel{
  opacity:0.85;
  filter:none;
  pointer-events:auto;
}
body.redeem-focus #leaderboard,
body.redeem-focus #reward-teasers,
body.redeem-focus #dev-panel,
body.redeem-focus #branding-panel,
body.redeem-focus #controls-panel,
body.redeem-focus #board-frame,
body.redeem-focus #slot-tray,
body.redeem-focus #tray-dividers,
body.redeem-focus #board-divider,
body.redeem-focus #board-title{
  opacity:0.18;
  filter:blur(2px) brightness(0.9);
  pointer-events:none;
}

/* (Omitted repeating earlier full styling for brevity; keep previous gift cards, slot labels, settings, etc.) */
/* Preserve previous CSS you already have for leaderboard, gifts, settings, dev-panel, resize handle, etc. */