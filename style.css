/* STYLE UPDATE (Focus: make commands panel always visible & above everything)
   Key changes:
   - Added high z-index to #overlay and explicit z-index layers for canvases.
   - Forced #commands-panel to use normal left/top positioning (no translate).
   - Removed opacity dimming for #commands-panel in redemption focus.
   - Added defensive opacity:1 !important and visibility:visible.
   - Added .force-show helper class you can toggle in console.
*/

:root {
  --bg:#08101c;
  --txt:#f0f6ff;
  --muted:#9fb0c6;
  --cyan:#00f2ea;
  --pink:#ff1180;
  --gold:#f7d25c;
  --bronze:#c97a32;
  --silver:#c9d2df;
  --danger:#ff5d5d;
  --good:#5df28f;
  --panel-bg:rgba(14,22,34,0.78);
  --panel-border:rgba(255,255,255,0.18);
  --shadow-strong:0 0 30px rgba(0,242,234,0.40),0 0 60px rgba(255,0,128,0.30);
  --transition:0.25s cubic-bezier(.4,.14,.3,1);
  --drag-bar-height:34px;
}

*{box-sizing:border-box;margin:0;padding:0;}

html,body,#app,#game-container{
  width:100%;height:100%;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,Arial,'Noto Sans',sans-serif;
  color:var(--txt);
  background:#08101c;
  overflow:hidden;
  background-image:
    radial-gradient(1200px 800px at 15% 20%,rgba(0,242,234,0.22),transparent 70%),
    radial-gradient(1000px 750px at 85% 80%,rgba(255,0,128,0.18),transparent 72%),
    linear-gradient(140deg,#08101c,#0d1e2f 55%,#112235);
  animation:bgPulse 18s linear infinite;
  background-blend-mode:screen,screen,normal;
}
@keyframes bgPulse{
  0%,100%{filter:brightness(1) saturate(1);}
  50%{filter:brightness(1.15) saturate(1.22);}
}

#game-container{position:relative;}

/* Canvas layering */
#game-container > canvas{
  position:absolute;
  inset:0;
  z-index:100; /* base game canvas */
}
#fx-canvas{
  z-index:150; /* particle fx above main render but below UI */
  pointer-events:none;
}

#board-frame,#board-divider,#slot-tray,#board-title{
  position:absolute;inset:0;pointer-events:none;
  z-index:120;
}

#overlay{
  position:absolute;inset:0;
  display:grid;
  grid-template-columns:340px 1fr 300px;
  grid-template-rows:auto 1fr;
  gap:14px;
  padding:14px;
  pointer-events:none;
  z-index:900; /* UI ABOVE EVERYTHING */
}

/* Shared panel basics */
.panel, #reward-teasers, #leaderboard, #commands-panel, #dev-panel, .branding, #settings-panel{
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  backdrop-filter:blur(14px) saturate(160%);
  box-shadow:var(--shadow-strong);
}

.branding, #controls-panel{
  pointer-events:auto;
  display:flex;
  gap:12px;
  align-items:center;
  padding:10px 18px;
  border-radius:16px;
  z-index:910;
  position:relative;
}
.branding .logo{font-weight:900;font-size:20px;}
.branding .live{font-size:14px;font-weight:700;color:var(--cyan);letter-spacing:1px;}
#btn-gear{
  background:#132536;
  border:1px solid #264063;
  border-radius:14px;
  padding:10px 16px;
  cursor:pointer;
  color:var(--txt);
  font-weight:600;
  box-shadow:0 0 12px rgba(0,242,234,0.45);
  transition:var(--transition);
}
#btn-gear:hover{filter:brightness(1.2);transform:translateY(-2px);}

/* COMMANDS PANEL â€” absolute left/top + scale only */
#commands-panel{
  position:absolute;
  left:40px; /* JS will adjust */
  top:100px; /* JS will adjust */
  width:340px;
  pointer-events:auto;
  border-radius:28px;
  padding:16px 20px 30px;
  z-index:9999 !important;
  transform-origin:top left;
  /* we let JS apply transform: scale(S) */
  opacity:1 !important;
  visibility:visible !important;
  filter:none !important;
  transition:filter var(--transition), box-shadow var(--transition);
}
#commands-panel.force-show{
  outline:2px solid #ff0;
  box-shadow:0 0 0 3px #ff0,0 0 20px #ff0;
}

.cmd-title{
  font-weight:900;
  font-size:24px;
  letter-spacing:2px;
  text-align:center;
  margin:0 0 16px;
  background:linear-gradient(90deg,#fff,#00f2ea 45%,#ff5aa0 80%);
  -webkit-background-clip:text;
  color:transparent;
  text-shadow:0 0 14px rgba(0,242,234,0.65),0 0 30px rgba(255,0,128,0.5);
  cursor:grab;
}

.cmd-section{margin-bottom:16px;}
.cmd-section-title{
  margin:0 0 8px;
  font-size:11px;
  font-weight:800;
  letter-spacing:2px;
  color:#c2d4e5;
  display:flex;
  gap:8px;
  align-items:center;
}
.cmd-section-title::after{
  content:'';
  flex:1;
  height:1px;
  background:linear-gradient(90deg,rgba(255,255,255,0.18),rgba(255,255,255,0));
}
.cmd-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;}
.cmd-line{
  display:flex;
  gap:10px;
  align-items:center;
  background:linear-gradient(140deg,rgba(255,255,255,0.10),rgba(255,255,255,0.03));
  border:1px solid rgba(255,255,255,0.14);
  padding:10px 12px;
  border-radius:14px;
  transition:var(--transition);
  backdrop-filter:blur(6px);
}
.cmd-line:hover{filter:brightness(1.2) saturate(1.1);transform:translateY(-3px);}
.cmd-line.tier-t3{box-shadow:0 0 0 1px rgba(247,210,92,.45),0 0 18px rgba(247,210,92,.35);}
.cmd-line.tier-t2{box-shadow:0 0 0 1px rgba(191,196,206,.4),0 0 14px rgba(191,196,206,.28);}
.cmd-line.tier-t1{box-shadow:0 0 0 1px rgba(201,122,50,.4),0 0 14px rgba(201,122,50,.28);}
.cmd-badge{
  font-weight:900;
  font-size:18px;
  min-width:56px;
  text-align:center;
  background:linear-gradient(90deg,#fff,#00f2ea 40%,#ff5aa0 80%);
  -webkit-background-clip:text;
  color:transparent;
  filter:drop-shadow(0 0 6px rgba(0,242,234,0.6));
}
.cmd-text{font-size:14px;font-weight:600;color:#eaf5ff;flex:1;}

.gift-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:12px;}
.gift-card{
  background:linear-gradient(150deg,rgba(255,255,255,0.14),rgba(255,255,255,0.04));
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  padding:8px 6px 10px;
  text-align:center;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  transition:var(--transition);
  backdrop-filter:blur(6px);
}
.gift-card:hover{transform:translateY(-6px) scale(1.08);filter:brightness(1.25);}
.gift-card img{width:52px;height:52px;object-fit:contain;filter:drop-shadow(0 0 10px rgba(255,255,255,0.4));transition:var(--transition);}
.gift-card:hover img{transform:scale(1.15) rotate(6deg);}
.gift-name{margin-top:4px;font-size:12px;font-weight:700;color:#e6f4ff;}
.gift-note{font-size:11px;opacity:.75;font-weight:600;}
.gift-note.accent{color:#ffd570;text-shadow:0 0 8px rgba(247,210,92,.5);}
.gift-hint{text-align:center;font-size:10px;color:var(--muted);opacity:.55;margin-top:6px;}
.cmd-move-hint{text-align:center;font-size:11px;color:#b7c5d7;opacity:.75;margin-top:10px;font-weight:600;}
.tiny-reset{
  margin:14px auto 0;
  display:block;
  background:linear-gradient(145deg,#153040,#10222f);
  border:1px solid #264d62;
  font-size:11px;
  padding:6px 10px;
  border-radius:10px;
  color:#e4faff;
  cursor:pointer;
  transition:var(--transition);
}
.tiny-reset:hover{filter:brightness(1.25);}

#leaderboard{z-index:910;}
#reward-teasers{z-index:910;}
#settings-panel{position:absolute;z-index:920;left:calc(100% - 400px);top:90px;width:360px;max-height:70vh;overflow:auto;border-radius:24px;opacity:0;pointer-events:none;transition:var(--transition);}
#settings-panel.open{opacity:1;pointer-events:auto;}
#settings-panel .drag-bar{
  height:var(--drag-bar-height);
  display:flex;
  align-items:center;
  padding:0 12px;
  font-weight:900;
  font-size:14px;
  letter-spacing:1.2px;
  background:linear-gradient(90deg,rgba(0,242,234,0.22),rgba(255,0,128,0.22));
  border-radius:18px;
  cursor:grab;
  position:sticky;top:0;
}
.close-small{
  margin-left:auto;
  background:rgba(255,255,255,0.1);
  border:1px solid rgba(255,255,255,0.2);
  color:var(--txt);
  border-radius:8px;
  cursor:pointer;
  padding:4px 8px;
  font-size:12px;
  font-weight:700;
  transition:var(--transition);
}
.close-small:hover{filter:brightness(1.25);}

.settings-group{display:grid;gap:14px;margin-top:14px;}
.settings-group label{display:grid;gap:6px;font-size:14px;color:#c4d2e2;font-weight:600;}
.settings-group label.row{grid-auto-flow:column;align-items:center;}
.settings-group input[type="range"],
.settings-group input[type="url"],
.settings-group input[type="password"],
.settings-group input[type="text"]{
  width:100%;background:#102033;border:1px solid #264162;color:var(--txt);padding:10px 12px;border-radius:12px;font-size:14px;font-weight:500;
}

#dev-panel{
  position:absolute;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  z-index:905;
  padding:6px 10px 12px;
  border-radius:18px;
  pointer-events:auto;
}
#dev-panel .drag-bar.small{
  height:30px;
  display:flex;
  align-items:center;
  cursor:grab;
  font-weight:800;
  padding:0 10px;
  font-size:13px;
  background:linear-gradient(90deg,rgba(0,242,234,0.22),rgba(255,0,128,0.22));
  border-radius:14px;
  margin:4px;
}
.dev-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
#dev-panel button{
  background:#162334;color:#cfe9ff;border:1px solid #28405f;
  border-radius:8px;padding:6px 10px;font-size:12px;font-weight:600;cursor:pointer;
  transition:var(--transition);
}
#dev-panel button:hover{background:#244357;}
.dev-free{font-size:11px;display:flex;align-items:center;gap:4px;color:#eee;font-weight:600;padding:0 4px;}

#redeem-layer{
  position:absolute;
  inset:0;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  pointer-events:none;
  padding-bottom:60px;
  z-index:950;
}
.redeem-user-card{
  background:rgba(12,20,32,0.82);
  border:2px solid var(--cyan);
  border-radius:20px;
  padding:16px 22px;
  display:flex;
  gap:16px;
  align-items:center;
  font-size:16px;
  font-weight:600;
  backdrop-filter:blur(12px) saturate(160%);
  box-shadow:0 0 36px rgba(0,242,234,0.4),0 0 70px rgba(255,0,128,0.3);
  transform:translateY(24px) scale(.88);
  opacity:0;
}

#perf-panel{
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(0,0,0,0.55);
  color:#d2faff;
  padding:8px 10px;
  border-radius:10px;
  font:12px/1.2 system-ui,monospace;
  z-index:960;
  pointer-events:none;
}

/* Resize handle */
.resize-handle{
  position:absolute;
  width:14px;
  height:14px;
  bottom:6px;
  right:6px;
  background:linear-gradient(135deg,rgba(255,255,255,0.4),rgba(255,255,255,0.1));
  border:1px solid rgba(255,255,255,0.5);
  border-radius:4px;
  cursor:nwse-resize;
  box-shadow:0 0 6px rgba(255,255,255,0.25);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:700;
  color:#112033;
  user-select:none;
}

.drag-enabled.dragging{outline:2px dashed var(--cyan);}

/* Redemption focus: do NOT dim commands panel now */
body.redeem-focus #board-frame,
body.redeem-focus #slot-tray,
body.redeem-focus #tray-dividers,
body.redeem-focus #board-divider,
body.redeem-focus #board-title,
body.redeem-focus #leaderboard,
body.redeem-focus #reward-teasers,
body.redeem-focus #dev-panel,
body.redeem-focus #branding-panel,
body.redeem-focus #controls-panel{
  opacity:0.2;
  filter:blur(2px) brightness(.9);
  pointer-events:none;
}
body.redeem-focus #redeem-layer .redeem-user-card{filter:none;}
body.redeem-focus #commands-panel{
  opacity:1 !important;
  filter:none !important;
  pointer-events:auto;
}

/* Responsive adjustments */
@media (max-width:1280px){ #overlay{grid-template-columns:320px 1fr 260px;} }
@media (max-width:1050px){ #overlay{grid-template-columns:280px 1fr 250px;} }
@media (max-width:900px){
  #overlay{grid-template-columns:1fr 250px;grid-template-rows:auto auto 1fr;}
  #leaderboard{grid-column:1 / span 2;order:3;}
  #right-stack{grid-column:2;grid-row:2;}
  #dev-panel{top:auto;bottom:12px;left:auto;transform:none;right:12px;}
}
@media (max-width:680px){
  #overlay{grid-template-columns:1fr;grid-template-rows:auto auto auto 1fr;}
  #right-stack{grid-column:1;grid-row:3;flex-direction:row;flex-wrap:wrap;}
  #commands-panel{width:min(92vw,420px);}
  #leaderboard{order:4;}
}