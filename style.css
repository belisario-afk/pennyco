/* ADDITIONS for guaranteed commands visibility:
   - #overlay z-index
   - #commands-panel z-index & force-front class
   - Panic highlight animation
   - Buttons: #btn-show-commands, #btn-panic-commands, #btn-force-commands
*/

:root {
  --bg:#08101c;
  --txt:#f0f6ff;
  --muted:#9fb0c6;
  --cyan:#00f2ea;
  --pink:#ff1180;
  --gold:#f7d25c;
  --bronze:#c97a32;
  --silver:#c9d2df;
  --danger:#ff5d5d;
  --good:#5df28f;
  --panel-bg:rgba(14,22,34,0.78);
  --panel-border:rgba(255,255,255,0.18);
  --shadow-strong:0 0 30px rgba(0,242,234,0.40),0 0 60px rgba(255,0,128,0.30);
  --transition:0.25s cubic-bezier(.4,.14,.3,1);
  --scale-handle-size:14px;
  --drag-bar-height:34px;
}

*{box-sizing:border-box;}

html,body,#app,#game-container{
  margin:0;padding:0;width:100%;height:100%;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,Arial,'Noto Sans',sans-serif;
  color:var(--txt);overflow:hidden;background:#08101c;
  background-image:
    radial-gradient(1200px 800px at 15% 20%,rgba(0,242,234,0.22),transparent 70%),
    radial-gradient(1000px 750px at 85% 80%,rgba(255,0,128,0.18),transparent 72%),
    linear-gradient(140deg,#08101c,#0d1e2f 55%,#112235);
  background-blend-mode:screen,screen,normal;
  animation:bgPulse 18s linear infinite;
}
@keyframes bgPulse{
  0%,100%{filter:brightness(1) saturate(1);}
  50%{filter:brightness(1.15) saturate(1.22);}
}

#game-container{position:relative;}
#fx-canvas,#board-frame,#board-divider,#slot-tray,#board-title{position:absolute;inset:0;pointer-events:none;}

#overlay{
  position:absolute;inset:0;
  display:grid;
  grid-template-columns:340px 1fr 300px;
  grid-template-rows:auto 1fr;
  gap:14px;padding:14px;
  pointer-events:none;
  z-index:300; /* HIGHER than anything else except redeem layer */
}

.branding{
  pointer-events:auto;
  display:flex;align-items:center;gap:12px;
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:10px 18px;
  backdrop-filter:blur(12px) saturate(160%);
  box-shadow:0 0 18px rgba(0,242,234,0.3);
  font-size:20px;font-weight:800;
}
.branding .live{font-size:14px;font-weight:700;color:var(--cyan);letter-spacing:1px;}
#controls-panel{pointer-events:auto;display:flex;align-items:center;gap:8px;}
#btn-gear,#btn-show-commands,#btn-panic-commands,#btn-force-commands{
  background:linear-gradient(145deg,#132536,#0f1d2c);
  color:var(--txt);border:1px solid #264063;
  border-radius:14px;padding:8px 12px;cursor:pointer;
  font-size:14px;font-weight:600;
  box-shadow:0 0 12px rgba(0,242,234,0.4);
  transition:var(--transition);
}
#btn-gear:hover,#btn-show-commands:hover,#btn-panic-commands:hover,#btn-force-commands:hover{
  filter:brightness(1.18);transform:translateY(-2px);
}

.panel{
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:24px;
  backdrop-filter:blur(16px) saturate(170%);
  box-shadow:var(--shadow-strong);
  position:relative;
  pointer-events:auto;
}

/* Commands panel — guaranteed top */
#commands-panel{
  pointer-events:auto;
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:28px;
  padding:16px 18px 28px;
  position:relative;
  backdrop-filter:blur(18px) saturate(170%);
  box-shadow:0 0 40px rgba(0,242,234,0.65),0 0 80px rgba(255,0,128,0.45);
  width:340px;
  z-index:5000 !important;
}
#commands-panel.force-front{
  z-index:999999 !important;
}
#commands-panel.hidden-soft{
  opacity:0 !important;
  pointer-events:none !important;
}

.cmd-title{
  font-weight:900;font-size:24px;letter-spacing:2px;text-align:center;margin:0 0 14px;
  background:linear-gradient(90deg,#fff,#00f2ea 45%,#ff5aa0 80%);
  -webkit-background-clip:text;color:transparent;
  text-shadow:0 0 12px rgba(0,242,234,0.6),0 0 26px rgba(255,0,128,0.5);
  cursor:grab;
  position:relative;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.mini-close{
  position:absolute;
  right:6px; top:6px;
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.3);
  color:var(--txt);
  font-size:11px;
  padding:4px 6px;
  border-radius:8px;
  cursor:pointer;
  transition:var(--transition);
}
.mini-close:hover{filter:brightness(1.25);}

.cmd-section{margin-bottom:16px;}
.cmd-section-title{
  margin:0 0 8px;font-size:11px;font-weight:800;letter-spacing:2px;color:#c2d4e5;display:flex;align-items:center;gap:8px;
}
.cmd-section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(255,255,255,.2),rgba(255,255,255,0));}
.cmd-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;}
.cmd-line{
  display:flex;align-items:center;gap:10px;
  background:linear-gradient(140deg,rgba(255,255,255,0.10),rgba(255,255,255,0.02));
  padding:10px 12px;border-radius:14px;
  border:1px solid rgba(255,255,255,0.18);
  backdrop-filter:blur(6px);
  transition:var(--transition);
}
.cmd-line:hover{filter:brightness(1.22);transform:translateY(-3px);}
.cmd-line.tier-t3{box-shadow:0 0 0 1px rgba(247,210,92,.45),0 0 18px rgba(247,210,92,.40);}
.cmd-line.tier-t2{box-shadow:0 0 0 1px rgba(191,196,206,.40),0 0 16px rgba(191,196,206,.35);}
.cmd-line.tier-t1{box-shadow:0 0 0 1px rgba(201,122,50,.40),0 0 16px rgba(201,122,50,.34);}
.cmd-line.neutral{box-shadow:0 0 0 1px rgba(0,242,234,.40),0 0 16px rgba(0,242,234,.30);}
.cmd-badge{font-weight:900;font-size:18px;letter-spacing:1px;min-width:56px;text-align:center;background:linear-gradient(90deg,#fff,#00f2ea 45%,#ff5aa0 80%);-webkit-background-clip:text;color:transparent;filter:drop-shadow(0 0 4px rgba(0,242,234,0.55));}
.cmd-badge.small{font-size:14px;min-width:70px;}
.cmd-text{font-size:14px;font-weight:600;flex:1;color:#eaf5ff;letter-spacing:.5px;}

.gift-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:12px;}
.gift-card{
  background:linear-gradient(155deg,rgba(255,255,255,0.12),rgba(255,255,255,0.03));
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  padding:8px 6px 10px;
  text-align:center;
  backdrop-filter:blur(6px);
  cursor:pointer;
  transition:var(--transition);
}
.gift-card:hover{transform:translateY(-6px) scale(1.1);filter:brightness(1.22) saturate(1.25);}
.gift-card img{width:52px;height:52px;object-fit:contain;filter:drop-shadow(0 0 8px rgba(255,255,255,0.35));transition:var(--transition);}
.gift-card:hover img{transform:scale(1.12) rotate(6deg);}
.gift-name{margin-top:4px;font-size:12px;font-weight:700;letter-spacing:.5px;color:#e6f4ff;}
.gift-note{font-size:11px;opacity:.75;font-weight:600;}
.gift-note.accent{color:#ffd570;text-shadow:0 0 8px rgba(247,210,92,.55);}
.gift-hint{text-align:center;font-size:10px;color:var(--muted);opacity:.6;margin-top:6px;}
.cmd-move-hint{text-align:center;font-size:11px;color:#b7c5d7;opacity:.75;margin-top:10px;font-weight:600;}

.force-recenter{
  animation:flashBorder 1.4s ease-in-out 0s 1;
}
@keyframes flashBorder{
  0%{box-shadow:0 0 0 0 rgba(255,255,255,0),0 0 0 0 rgba(0,242,234,0);}
  20%{box-shadow:0 0 0 3px rgba(255,255,255,0.6),0 0 40px 12px rgba(0,242,234,0.65);}
  60%{box-shadow:0 0 0 2px rgba(255,255,255,0.35),0 0 26px 6px rgba(0,242,234,0.4);}
  100%{box-shadow:0 0 40px rgba(0,242,234,0.6),0 0 80px rgba(255,0,128,0.45);}
}

/* Keep redemption focus from hiding commands */
body.redeem-focus #commands-panel{
  opacity:0.85 !important;
  filter:none !important;
  pointer-events:auto !important;
}

.drag-enabled{position:relative;}
.drag-enabled.dragging{outline:2px dashed var(--cyan);}

/* (Other previous panel / leaderboard / settings / etc. styles trimmed for brevity—they remain unchanged from last version except layering) */

/* Responsive quick fixes */
@media(max-width:900px){
  #commands-panel{width:92vw;}
}